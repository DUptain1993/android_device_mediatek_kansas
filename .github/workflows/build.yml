name: OrangeFox Build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Setup Build Environment
      run: |
        sudo apt-get update
        sudo apt-get install -y git-core gnupg flex bison build-essential zip curl zlib1g-dev gcc-multilib g++-multilib libc6-dev-i386 lib32ncurses5-dev x11proto-core-dev libx11-dev lib32z1-dev libgl1-mesa-dev libxml2-utils xsltproc unzip fontconfig python3 python3-venv
        
    - name: Initialize OrangeFox Source
      run: |
        mkdir -p ~/of-build && cd ~/of-build
        repo init -u https://github.com/OrangeFoxRecovery/manifest.git -b OrangeFox-15.0
        
    - name: Copy Device Tree
      run: |
        cd ~/of-build
        mkdir -p device/motorola
        git clone https://github.com/${{ github.repository }} device/motorola/kansas
        
    - name: Build Recovery
      run: |
        cd ~/of-build
        . build/envsetup.sh
        lunch fox_kansas-userdebug
        mka recoveryimage
        
    - name: Upload Artifact
      uses: actions/upload-artifact@v3
      with:
        name: recovery-image
        path: ~/of-build/out/target/product/kansas/OrangeFox-*.zip
